<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Annunci Auto</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: black;
            color: white;
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 5000px;
            height: 1250px;
        }
        .slideshow {
            display: flex;
            width: 5000px;
            height: 1250px;
            perspective: 2000px;
        }
        .flip-container {
            display: flex;
            width: 100%;
            height: 100%;
            transition: transform 1.3s;
            transform-style: preserve-3d;
        }
        .flip {
            transform: rotateY(180deg);
        }
        .image-container, .info-container {
            width: 33.33%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }
        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        .image-container img.active {
            opacity: 1;
        }
        .info-container {
            flex-direction: column;
            text-align: center;
        }
        .info-container img {
            width: 1180px;
            margin-bottom: 20px;
        }
        .title {
            font-size: 128px;
            font-weight: bold;
            color: white;
        }
        .price {
            font-size: 128px;
            font-weight: bold;
            color: red;
        }
        .details {
            font-size: 80px;
            color: lightblue;
        }
    </style>
</head>
<body>
    <div class="slideshow">
        <div class="flip-container" id="flip-container">
            <div class="image-container" id="left-image"></div>
            <div class="info-container">
                <img src="https://cdnwp.dealerk.com/86ea5cfd/uploads/sites/27/2025/03/logo.png" alt="AutoShopping Logo">
                <div class="title" id="title"></div>
                <div class="price" id="price"></div>
                <div class="details" id="km"></div>
                <div class="details" id="power"></div>
                <div class="details" id="gear"></div> <!-- Aggiunta la voce per il cambio -->
            </div>
            <div class="image-container" id="right-image"></div>
        </div>
    </div>
    
    <script>
        function openFullscreen() {
            let elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.mozRequestFullScreen) {
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            openFullscreen();
        });

        document.addEventListener("click", () => {
            if (!document.fullscreenElement) {
                openFullscreen();
            }
        });

        let carIndex = 0;
        let imageIndex = 0;
        let carsData = [];
        let flipContainer = document.getElementById("flip-container");

        function showCar(index) {
            let car = carsData[index];
            if (!car) return;

            let leftImageContainer = document.getElementById("left-image");
            let rightImageContainer = document.getElementById("right-image");

            leftImageContainer.innerHTML = "";
            rightImageContainer.innerHTML = "";

            let leftImg = document.createElement("img");
            let rightImg = document.createElement("img");

            leftImg.src = car.images[imageIndex % car.images.length];
            rightImg.src = car.images[(imageIndex + 1) % car.images.length];

            leftImg.classList.add("active");
            rightImg.classList.add("active");

            leftImageContainer.appendChild(leftImg);
            rightImageContainer.appendChild(rightImg);

            document.getElementById("title").textContent = `${car.marca} ${car.version}`;
            document.getElementById("price").textContent = `${parseFloat(car.price).toLocaleString('it-IT', { style: 'currency', currency: 'EUR' })}`;
            document.getElementById("km").textContent = `KM: ${car.km} km`;
            document.getElementById("power").textContent = `POTENZA: ${car.hp} CV / ${car.kw} kW`;
            document.getElementById("gear").textContent = `CAMBIO: ${car.gear}`;
        }

        function rotateImages() {
            if (carsData.length === 0) return;

            let car = carsData[carIndex];
            let leftImageContainer = document.getElementById("left-image").querySelector("img");
            let rightImageContainer = document.getElementById("right-image").querySelector("img");

            imageIndex += 2;

            if (imageIndex >= car.images.length) {
                imageIndex = 0;
                carIndex = (carIndex + 1) % carsData.length;

                flipContainer.classList.add("flip");

                setTimeout(() => {
                    showCar(carIndex);
                    flipContainer.classList.remove("flip");

                    // Rilettura dell'XML ogni volta che finisce il ciclo delle immagini
                    fetchXML();
                }, 1300);
            } else {
                let newLeftImg = document.createElement("img");
                let newRightImg = document.createElement("img");

                newLeftImg.src = car.images[imageIndex % car.images.length];
                newRightImg.src = car.images[(imageIndex + 1) % car.images.length];

                newLeftImg.classList.add("active");
                newRightImg.classList.add("active");

                document.getElementById("left-image").appendChild(newLeftImg);
                document.getElementById("right-image").appendChild(newRightImg);

                setTimeout(() => {
                    if (leftImageContainer) leftImageContainer.classList.remove("active");
                    if (rightImageContainer) rightImageContainer.classList.remove("active");

                    setTimeout(() => {
                        if (leftImageContainer) leftImageContainer.remove();
                        if (rightImageContainer) rightImageContainer.remove();
                    }, 1000);
                }, 100);
            }
        }

        function fetchXML() {
            fetch('http://localhost/proxy.php')
                .then(response => response.text())
                .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
                .then(xml => {
                    let cars = xml.getElementsByTagName("car");
                    carsData = Array.from(cars).map(car => ({
                        marca: car.getElementsByTagName("make")[0]?.textContent.trim() || "N/D",
                        version: car.getElementsByTagName("version")[0]?.textContent.trim() || "N/D",
                        price: parseFloat(car.getElementsByTagName("priceB2c")[0]?.textContent || 0).toFixed(2),
                        km: car.getElementsByTagName("km")[0]?.textContent || "N/D",
                        hp: car.getElementsByTagName("hp")[0]?.textContent || "N/D",
                        kw: car.getElementsByTagName("kw")[0]?.textContent || "N/D",
                        gear: car.getElementsByTagName("gearType")[0]?.textContent || "N/D",
                        images: [...car.getElementsByTagName("image")].map(img => img.textContent)
                    }));

                    showCar(0);
                });
        }

        // Chiamata per la lettura dell'XML all'inizio
        fetchXML();

        // Esegui la rotazione delle immagini ogni 3 secondi
        setInterval(rotateImages, 3000);
    </script>
</body>
</html>


